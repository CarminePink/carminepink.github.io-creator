---
title: "《正则表达式》"
date: 2019-12-05T15:52:30+08:00
draft: false
---

在学习的过程中发现使用正则表达式和不会用正则表达式完全是两个概念，正则表达式可以节省我们许多时间，所以我在网上找了个教程学习了一下正则表达式，自己在博客里再总结一下自己学到的知识。参考的学习资料：[正则表达式 30 分钟入门教程](https://deerchao.cn/tutorials/regex/regex.htm)

## 什么是正则表达式

在我们写程序或者网页的时候，经常会需要找到一些符合复杂规则的字符串，正则表达式就是描述这些规则的工具，就是用来进行文本匹配的工具。

## 元字符

先把常见的元字符列出来

![常见的元字符](/images/yuanzifu.png)

- `.`匹配除换行符以外的任意字符

* `\b`代表单词的开头或结尾，它**只是匹配一个位置**

- `\s`匹配任意的空白符，包括空格，制表符(Tab)，换行符，中文全角空格等

- 元字符`^`和`$`都匹配一个位置，和`\b`很像，都是匹配一个位置，不过`^`匹配的是字符串的开头，`$`匹配字符串的结尾，而`\b`同时匹配单词的开头或者结尾。正则表达式处理工具还有一个处理多行的选项。如果选中了这个选项，`^`和`$`的意义就变成了匹配行的开始处和结束处。

- `\d`只匹配**一个数字**

我们举几个例子

1. 正则表达式`\bhi\b`

   它匹配单词 hi

2. 正则表达式`0\d\d-\d\d\d\d\d\d\d\d`

   它匹配以 0 开头，然后跟着两个数字，再跟着一个-，再跟着 8 个数字的电话号码，

   所以 073-13823523825 就符合上面的正则表达式。`-`就是连字符，就匹配它自身。

3. 正则表达式`\ba\w*\b`

   它匹配一个以字母 a 开头的单词

   这里我们要注意一下，虽然`\w`匹配字母、数字、下划线、汉字，但是一般多个连续的`\w`就表示单词

## 限定符

![常见的限定符](/images/xiandingfu.png)

我们还是通过举几个例子来学习

1. 正则表达式`\d+`

   它匹配一个或多个连续的数字

2. 正则表达式`\b\w{6}\b`

   它匹配一个由六个字母组成的单词，如 google

3. 正则表达式`^\d{5,12}$`

   它匹配一个由 5-12 个数字组成的字符串

4. 正则表达式`^\w+`

   它匹配开头是单词的字符串，或者是开头是单词的那一行(具体匹配得看选项设置)，这是我的理解

   教程里说它匹配一行的第一个单词(或整个字符串的第一个单词)

## 字符转义

如果我们想用到`.`或者`*`这些字符，但是这些字符本身会被解释成其他意思，所以这时候就要用`\`来取消这些字符的特殊性。

举个例子

1. `\.`就表示 `.`
2. `\\`就表示`\`
3. `\*`就表示`*`
4. `\(`就表示`(`

## 字符类

如果我们想匹配没有预定义元字符的字符集合(比如元音字母 a,e,i,o,u),应该怎么办？我们只需要在方括号[]中列出他们即可。

如`[aeiou]`就匹配任何一个英文元音字母，`[.?!]`匹配标点符号(.或?或!)，注意 ，没有加逗号！！！

- 我们可以在方括号里指定一个字符范围

  如`[0-9]`就匹配一个数字，和`\d`完全一个意思。

我们举个复杂的例子

正则表达式`\(?0\d{2}[) -]?\d{8}`

我们来一点一点分析，首先是转义字符`\(`匹配`(`，它的后面跟着一个限定符?，所以`(`可能出现 0 次或 1 次，然后是个数字 0，接下来是`\d{2}`匹配 2 个数字,再然后是`[) -]`它匹配`)`或者`-`都可以，由于后面跟着一个限定符?，所以他也是可能被出现 0 次或 1 次，接下来是`\d{8}`它匹配 8 个数字.综上，这个表达式匹配三种格式的电话号码，比如(010)88886666，或 022-22334455，或 02912345678 等

但是！刚才那个表达式也能匹配 010)12345678 或(022-87654321 这样的“不正确”的格式。要解决这个问题，我们需要用到**分枝条件**

## 分支条件

正则表达式里的分支条件指的是有多个正则表达式，用`|`分隔开来，如果满足其中任意一种表达式都应该当成匹配成功。

举个例子

1. `0\d{2}-\d{8}|0\d{3}-\d{7}`

   我们来分析一下，`|`前面的正则表达式是``0\d{2}-\d{8}`后面是`0\d{3}-\d{7}`，所以它匹配两种以连字符分隔的电话号码，前一种是区号有 3 位，本地号有 8 位的电话号码，后一种是区号有 4 位，本地号有 7 位的电话号码。

2. `\(0\d{2}\)[- ]?\d{8}|0\d{2}[- ]?\d{8}`

   分析一下，`|`前面的正则表达式是`\(0\d{2}\)[- ]?\d{8}`，后面的是`0\d{2}[- ]?\d{8}`，所以它也匹配两种电话号码，前一种是区号用小括号()包起来吗，可能有连字符-或者空格 也可能没有 ，本地号为 8 位的电话号码，后一种是区号没有任何修饰，可能有连字符-或者空格 也可能没有，本地号为 8 位的电话号码。

**_使用分支条件要注意各个条件的顺序，因为匹配条件时，是从左到右逐个测试是否满足条件，若满足了某个条件的话，则不再继续管其他条件了。_**

## 分组

我们可以用限定符重复单个字符，但是如果我们想重复多个字符该怎么办呢？我们可以用小括号来指定子表达式，也叫做**分组**，这样我们就可以对分组用限定符指定重复次数了。

举个例子：

1. 正则表达式`(\d{1,3}\.){3}\d{1,3}`

   我们一点一点分析，首先是一个分组`(\d{1,3}\.)`，这个分组里面的内容匹配一个数字重复 1 到 3 次，然后是一个.字符，然后整个分组内容会重复 3 次，最后再加上一个数字重复 1 到 3 次。我们可以发现，这就是一个 IP 地址的表达式。

   但是上述 IP 地址的表达式可能不规范，以为不能出现 999.999.999.999 这样的 IP 地址，所以我们要用一个复杂的正则表达式来表示正确的 IP 地址表达式。

   正则表达式`((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)`

   分析的话也不难，自己一点一点分析是可以分析出来的。

## 反义

有时我们想要查找符合某个条件以外的所有数据，比如我们想查找除了数字以外，其他任意字符都可以的数据，这时候我们就需要用到**反义**了。

![常见的反义代码](/images/fanyi.png)

举个例子：

1. 正则表达式`\S+`

   匹配不包括空白字符以外的所有字符

2. 正则表达式`<a[^>]+>`

   匹配用尖括号括起来，以 a 开头的所有字符串(这里面的`[^>]`就规定了字符 a 后面是除了反尖括号以外的所有字符)

## 后向引用

当我们用**分组**的方法指定了一个子表达式之后，若某个数据符合该分组的表达式，我们有可能在之后需要重复用到这个数据，而再次写一遍它的正则表达式很麻烦，这时候我们就需要用到后向引用了，默认情况下，当我们指定了若干个分组后，每个分组会自动拥有一个组号，组号分配的规则是:从左到右，以分组的左括号为标志，第一个出现的分组的组号为 1，第二个为 2，依次类推。(**_分组 0 代表整个正则表达式_**)

**后向引用**用于重复搜索某个分组匹配的数据,例如，`\1`代表分组 1 匹配的文本

举个例子:

1. 正则表达式`\b(\w+)\b\s+\1\b`

   匹配重复的单词，并且中间还有空格，例如 oh oh

   我们仔细分析一下，`\b(\w+)\b`匹配一个单词，这个单词是由一个或多个字母组成的，且由于用到了分组，所以这个单词会被捕获进组号为 1 的分组中去，然后是`\s+`匹配一个或多个空白符，最后是`\1`，也就是之前捕获的单词在这里再次用到了，不过是用后向引用的形式写出来了，

当然，我们也可以自己对分组指定组名，语法是`(?<Word>\w+)`(或者把尖括号换成单引号'也行：`(?'Word'\w+))`,这样就把`\w+`的组名指定为 Word 了，如果要反向引用这个分组，用`\k<Word>`，就可以引用组名为 Word 的分组了。所以上面的例子我们可以改写为

`\b(?<group1>\w+)\b\s+\k<group1>\b`，把分组的组名命名为 group1，引用的时候用`\k<group1>`引用

使用小括号进行分组后，还有很多其他用途的语法，这里罗列一下

![常用分组语法](/images/fenzuyufa.png)

## 零宽断言

当我们想要查找某些内容之前或之后的数据,但是并不包括这些内容时，这些内容就好比是参照物一样，找到他前面或后面的数据，他们就像是`\b,^,$`那样，指定一个位置，这个位置满足一定的条件(即断言)，因此他们被称为零宽断言。

- `(?=exp)` 匹配 exp 前面的位置

  `(?=exp)` 也叫**零宽度正预测先行断言**，它断言自身出现位置后面的内容能匹配表达式 exp，举个例子

  1. 正则表达式`\b\w+(?=ing\b)`

  匹配以 ing 结尾的单词的前面部分(除了 ing 以外的部分)，比如 I'm singing while you're dancing.时，它会匹配 sing 和 danc。

- `(?<=exp)` 匹配 exp 后面的位置

  `(?<=exp)`也叫**零宽度正回顾后发断言**，它断言自身出现位置前面的内容能匹配表达式 exp，举个例子

  1. 正则表达式`(?<=\bre)\w+\b`

  匹配以 re 开头的单词的后面部分(不包括 re)，比如在查找 reading a book 时，它匹配 ading。

  再举一个同时使用了两种断言的例子

  2. 正则表达式`(?<=\s)\d+(?=\s)`

  匹配空白字符间隔的数字(不包括空白符)

## 负向零宽断言

我们已经知道用反义来查找符合某个条件以外的所有数据，但是如果我们想要确保某个条件不会出现(就是我们不想要的条件)，但是我们又不想去匹配这个条件的时候该怎么办呢？

举个例子：如果我们想查找这样的单词--它里面出现了字母 q,但是 q 后面跟的不是字母 u

1. 正则表达式可以这样写`\b\w*q[^u]\w*\b`

   匹配一个包含字母 q 且 q 后面不是字母 u 的单词，但是并不严谨，因为如果 q 是单词的最后一个字母的话，`[^u]`就可能匹配到单词的分隔符，比如空格之类的字符，而后面的`\w*\b`将会匹配到下一个单词，于是就可能匹配到这样的 Iraq fighting 结果，不符合我们的预期。**负向零宽断言**可以解决这个问题，因为既然是零宽断言，它就只匹配一个位置，不会消耗字符，所以上面的正则表达式严谨的写法应该是`\b\w*q(?!u)\w*\b`

- **零宽度负预测先行断言**`(?!exp)`,断言此位置的后面不能匹配内容 exp，举个例子

  1. 正则表达式`\d{3}(?!\d)`

  匹配三个数字，且这三个数字后面不能是数字。

  2.正则表达式`\b((?!abc)\w)+\b`

  匹配一个单词，且这个单词里面没有 abc 这个连续的字符串

* **零宽度负回顾后发断言**`(?<!exp)`,断言此位置的前面不能匹配内容 exp，举个例子

  1. 正则表达式`(?<![a-z])\d{7}`

  匹配一个 7 位数字，且这个数字的前面不能是小写字母

  这里有个更复杂的例子,用到了前面知识的综合

  2. 正则表达式`(?<= <(\w+)>).*(?=<\/\1>)`

  我们一点一点分析，`(?<= <(\w+)>)`这是一个零宽度正回顾后发断言，exp 匹配的内容是`<(\w+)>`，所以看得出来是一个 HTML 标签的前面部分，比如`<div>`标签，所以理解下来就是这个位置的前面内容要匹配一个 HTML 标签的前面部分，`.*`很好理解，匹配任意字符，可以是 0 个或多个，最后`(?=<\/\1>)`，这是一个零宽度正预测先行断言，exp 匹配的内容是`<\/\1>`,首先`\/`是一个转义字符，表示`/`，`\1`有用到了后向引用，代表第一个分组的内容，从前慢可以知道，第一个分组的内容是`(\w+)`，所以`(?=<\/\1>)`理解下来就是这个位置的后面内容匹配</div>,所以整个正则表达式就匹配一个简单 HTML 标签内里的内容。(当然，不包括这个标签本身，只匹配标签里的内容，至于为啥，再看看零宽断言的例子就明白了，只匹配 exp 之前或之后的内容，不包括 exp 内容本身)

## 注释

我们也可以用小括号`(?#comment)`来表示这是注释的内容。

举个例子

1. 正则表达式`2[0-4]\d(?#200-249)|25[0-5](?#250-255)|[01]?\d\d?(?#0-199)`

   这就是加了注释的一个 IP 地址(此 IP 地址没有写完整)

注意：添加注释的话，最好是启用“忽略模式里的空白符”选项，这样在编写表达式时能任意的添加空格，Tab，换行，而实际使用时这些都将被忽略
