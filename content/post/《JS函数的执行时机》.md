---
title: "《JS函数的执行时机》"
date: 2019-10-20T20:34:38+08:00
draft: false
---

## JS 函数的要素之一:执行时机

JS 函数执行的时机不同，得到的结果也不同。

我们举个例子

```JavaScript
let a = 1
function fn(){
    console.log(a)
}
a = 2
fn()//最后打印的结果是2
```

因为在执行函数 fn 之前，a 的值变为了 2，所以再打印 a 的值就是 2。

我们再看一个例子

```JavaScript
let i = 0
for(i = 0; i<6; i++){
  setTimeout(()=>{
    console.log(i)
  },0)
}
//最后打印的结果是六个6
```

为什么是打印出六个 6，而不是打印出 0,1,2,3,4,5 呢?原因就在 setTimeout()这个函数,它就是过一会执行的意思，至于过多久呢，就好比我正在打游戏，我妈说饭做好了让我过一会去吃，我肯定是先把手头上的游戏打完再去吃饭，所以 JS 也是同理，上述代码手头上的事就是 for 循环，所以当过一会打印 i 的值得时候，for 循环已经结束了，i 的值已经是 6 了，之余为什么打印出六次，就好比你订了六个实体闹钟，明天早上时间到了，肯定六个闹钟都会响一遍，所以这里也是同理，会打印六遍，所以最后的结果是六个 6.

要想让上述代码打印出 0,1,2,3,4,5

只需要这样写

```JavaScript
for(let i = 0; i<6; i++){
  setTimeout(()=>{
    console.log(i)
  },0)
}
//最后打印的结果就是0,1,2,3,4,5
```

因为在 for 循环里用 let 声明 i 的话，每次执行 for 循环，其实都会创建一个新的 i(只是看不到),这个 i 会保留当前 i 的值，所以不管你过多久打印 i，当时的 i 已经被保存了下来，所以会依次打印出 0,1,2,3,4,5

如何用另一个方法同样使 setTimeout 函数打印出 0,1,2,3,4,5 呢，我在看了[这篇博客之后受到了启发](https://www.jianshu.com/p/e5225ba4a025)

```JavaScript
for(var i = 0; i<6; i++){
  !function() {
    var j = i
    setTimeout(()=>{
        console.log(j)
    },0)
  }()
}
//最后打印的结果就是0,1,2,3,4,5
```

把 setTimeout 函数放在一个立即执行函数里面，这样**立即执行函数就创建了一个新的作用域把 setTimeout 函数包裹了起来,并且用 j 捕获每次循环时的 i**这样，打印出来的 i 就是每次循环时的 i。
